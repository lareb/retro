<%= render :partial => "/layouts/header_breadcrumb", :locals => {:header => "Classes", :sub_header => "manage Classes", :breadcrumb => @breadcrumb} %>
<!-- /.row -->
<div class="row">
    <div class="col-lg-12">
    <div class="panel panel-primary">
      <div class="panel-heading">        
        <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Classes <a href="#" class="toggle-list" style="float:right"><i class="fa fa-chevron-circle-right"></i></a></h3>
      </div>
      <div class="panel-body data-list-toggle">
        <div class="table-responsive">
          <table id="klasses" class="table table-striped table-bordered table-hover" >
            <thead>
              <tr>
                <th>Name</th>
                <th>Sections</th>
                <th>Students</th>
                <th>Teachers</th>
                <th>Fee</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% @klasses.each do |klass| %>
                <tr class="<%= cycle("odd", "even") %>">
                  <td><%= klass.display_name %></td>
                  <td>
                    <%= raw(klass.sections.map(&:display_name).join("<hr/>")) %>
                  </td>
                  <td>
                    <%= raw(klass.sections.collect{|s| link_to raw("<i class='fa fa-users'></i> Students"), klass_section_students_path(klass, s), :class => "btn btn-primary btn-xs" }.join("<hr/>"))  %>
                  </td>                  
                  <td>
                      <%= raw klass.sections.collect{|section| link_to(raw("<i class='fa fa-user'></i> Teachers"), klass_section_teacher_sections_path(klass, section), :remote => true, :class => "btn btn-primary btn-xs", "data-target" => "#modalId", "data-toggle" => "modal") + " " +
                        (link_to(raw("<i class='fa fa-plus'></i>"), new_klass_teacher_klass_path(klass), :class => "btn btn-primary btn-xs"))}.join("<hr/>") %>
                      
                  </td>
                  <td><%= link_to 'Edit', edit_klass_path(klass) %></td>
                  <td><%= link_to 'Fee', new_klass_fee_structure_path(klass) %></td>
                </tr>
              <% end %>

            </tbody>
          </table>
        </div>
        <!-- /.table-responsive -->
      </div>
      <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
  </div>
  <!-- /.col-lg-12 -->
</div>
<!-- /.row -->          
<br />

<%= link_to 'New Class', new_klass_path %>



<!-- Modal -->
<div class="modal fade" id="modalId" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Teachers</h4>
      </div>
      <div class="modal-body" id="teachers">
        <div class="loading"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <!--<button type="button" class="btn btn-primary">Save changes</button> -->
      </div>
    </div>
  </div>
</div>



<script src="/assets/admin/jquery.dataTables.js"></script>
<script src="/assets/admin/dataTables.bootstrap.js"></script> 
<script type="text/javascript">
  $(document).ready(function(){
    oTable = $('#klasses').dataTable({
       "sPaginationType": "full_numbers",
       "bJQueryUI": true,
      "iDisplayLength":50
    });

    $('#klasses tbody td a.open ').click(function (){
      var nTr1 = $(this).parents('tr')[0];
      console.log($(this));
      if (oTable.fnIsOpen(nTr1) && $(nTr1).next().find("td.add_new").length > 0) {
        oTable.fnClose(nTr1);
        //toggle icon class
        $(this).removeClass("shrink");
        $(this).addClass("expand");
        return false;
      }else{
        oTable.fnOpen(nTr1, showTeacher(nTr1, $(this).attr("class_id"), 'new'), "add_new new_member_"+$(nTr1).attr("id"));
        //toggle icon class
        $(this).removeClass("expand");
        $(this).addClass("shrink");
        return false;
      }
    });

  });
  
  function showTeachers(klass, section){

  }
</script>
